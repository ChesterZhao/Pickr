{% extends 'base.html' %}

{% block title %}Supervisor{% endblock %}

{% block content %}
    <body>
    <section class="page_hearder"><h1 class="first_title">Hi,{{ supervisor.first_name }} {{ supervisor.last_name }}!</h1>
        <p class="paragraph-3">In this page,you can create your topic and check your applications.</p></section>
    <section>
        <div data-current="Applications" class="w-tabs">
            <address class="tabs-menu w-tab-menu">
                <a data-w-tab="Topics" class="tab_link long_tab_link w-inline-block w-tab-link">
                    <div>Topics</div>
                </a>
                <a data-w-tab="Applications" class="tab_link long_tab_link w-inline-block w-tab-link">
                    <div>Applications</div>
                </a>
            </address>
            <div class="w-tab-content">

                {#Topics Section#}
                <div data-w-tab="Topics" class="w-tab-pane">
                    <div class="_40px_height"></div>
                    <h2 class="third_title-2 accent">Your Topics</h2>
                    <div class="text-block-2 phone_button">Position: <span
                            id="total-quota">{{ total_quta }}</span>/{{ supervisor.position }}</div>
                    <div class="_40px_height"></div>
                    {% for topic in topics %}
                        {% if topic.is_custom == 0 %}
                            <div id="w-node-_343ab568-d4a9-892d-c91d-a760dbd94c28-06e36864"
                                 class="w-layout-layout supervisor_result_item-2 supervisor_topic wf-layout-layout">
                                <div id="w-node-_343ab568-d4a9-892d-c91d-a760dbd94c29-06e36864"
                                     class="w-layout-cell cell-11">
                                    <div class="text-block-2"><em class="italic-text-3">{{ topic.name }}</em></div>
                                </div>
                                <div id="w-node-_343ab568-d4a9-892d-c91d-a760dbd94c2d-06e36864"
                                     class="w-layout-cell cell-8">
                                    <div class="text-block-2 italic-text _20_leading"><em>{{ topic.quota }}</em></div>
                                </div>
                                <div id="w-node-_343ab568-d4a9-892d-c91d-a760dbd94c31-06e36864"
                                     class="w-layout-cell cell-10">
                                    <div class="text-block-2 phone_button phone_leading">
                                        PK{{ "%04d"|format(topic.id) }}</div>
                                </div>
                                <div id="w-node-_343ab568-d4a9-892d-c91d-a760dbd94c34-06e36864"
                                     class="w-layout-cell cell-12">
                                    <a href="{{ url_for('edit_topic', topic_id = topic.id) }}" class="submit-button-2 w-button">Edit</a>
                                    <div class="div-block-4"></div>
                                    <a href="#" class="submit-button-2 delete_button w-button delete-topic"
                                       data-topic-id="{{ topic.id }}">Delete</a>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                    <div class="_40px_height"></div>
                    <a href="{{ url_for('new_topic') }}" class="submit-button-2 phone w-button"><em>+</em> New Topic</a>
                </div>

                {#Applications Section#}
                <div data-w-tab="Applications" class="w-tab-pane w--tab-active">
                    <div class="_40px_height"></div>
                    <h2 class="third_title-2 accent">Applications</h2>
                    <div class="_20px_height"></div>
                    <div id="w-node-_4bbf146a-34a9-d23a-f84c-f5f9d0167cc5-06e36864"
                         class="w-layout-layout supervisor_result_item-2 wf-layout-layout">
                        <div id="w-node-_4bbf146a-34a9-d23a-f84c-f5f9d0167cc6-06e36864" class="w-layout-cell cell-11">
                            <div class="text-block-2"><em class="italic-text-3">Collaborative Code Editor</em></div>
                        </div>
                        <div id="w-node-_4bbf146a-34a9-d23a-f84c-f5f9d0167cca-06e36864" class="w-layout-cell cell-8">
                            <div class="text-block-2 italic-text _20_leading"><em class="accent-2">1/2</em></div>
                        </div>
                        <div id="w-node-_0c60fc55-54be-aa12-927a-9a84a0a6b64c-06e36864" class="w-layout-cell cell-10"><a
                                href="#" class="submit-button w-button">View</a></div>
                    </div>
                    <div id="w-node-_56af5ad5-4164-93c2-bdb1-d8bf0fed846c-06e36864"
                         class="w-layout-layout supervisor_result_item-2 wf-layout-layout">
                        <div id="w-node-_56af5ad5-4164-93c2-bdb1-d8bf0fed846d-06e36864" class="w-layout-cell cell-11">
                            <div class="text-block-2"><em class="italic-text-3">Collaborative Code Editor</em></div>
                        </div>
                        <div id="w-node-_56af5ad5-4164-93c2-bdb1-d8bf0fed8471-06e36864" class="w-layout-cell cell-8">
                            <div class="text-block-2 italic-text _20_leading"><em class="accent-2">1/2</em></div>
                        </div>
                        <div id="w-node-_56af5ad5-4164-93c2-bdb1-d8bf0fed8475-06e36864" class="w-layout-cell cell-10"><a
                                href="#" class="submit-button w-button">View</a></div>
                    </div>
                    <div id="w-node-_93709fe4-a95d-a0f2-4d02-992aa4ffe1ea-06e36864"
                         class="w-layout-layout supervisor_result_item-2 wf-layout-layout">
                        <div id="w-node-_93709fe4-a95d-a0f2-4d02-992aa4ffe1eb-06e36864" class="w-layout-cell cell-11">
                            <div class="text-block-2"><em class="italic-text-3">Collaborative Code Editor</em></div>
                        </div>
                        <div id="w-node-_93709fe4-a95d-a0f2-4d02-992aa4ffe1ef-06e36864" class="w-layout-cell cell-8">
                            <div class="text-block-2 italic-text _20_leading"><em class="accent-2">1/2</em></div>
                        </div>
                        <div id="w-node-_93709fe4-a95d-a0f2-4d02-992aa4ffe1f3-06e36864" class="w-layout-cell cell-10"><a
                                href="#" class="submit-button w-button">View</a></div>
                    </div>
                    <div class="_40px_height"><a href="#" class="submit-button-2 phone w-button"><em>→</em> Export</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="_80px_height"></div>
    </section>
    <script>
        $(document).ready(function () {
            // 当选项卡链接被点击
            $('.tab_link').click(function (e) {
                e.preventDefault(); // 阻止链接的默认行为

                var tabId = $(this).attr('data-w-tab'); // 获取被点击选项卡的 data-w-tab 值

                // 移除所有选项卡链接的 'w--current' 类，并给被点击的链接添加 'w--current' 类
                $('.tab_link').removeClass('w--current');
                $(this).addClass('w--current');

                // 隐藏所有的选项卡内容
                $('.w-tab-pane').fadeOut(100); // 使用 fadeOut 方法隐藏

                // 显示与被点击选项卡相对应的内容区域
                // 使用 fadeIn 方法显示
                $('.w-tab-pane[data-w-tab="' + tabId + '"]').fadeIn(300);
            });

            // 模拟点击第一个选项卡，以便默认显示
            $('.tab_link').first().click();
        });

        $('.delete-topic').click(function (e) {
            e.preventDefault();
            var topicId = $(this).data('topic-id');
            var element = $(this).closest('.supervisor_result_item-2');
            var quota = parseInt(element.find('.italic-text').text());

            var confirmed = confirm("Are you sure you want to delete this topic?");

            if (confirmed) {
                $.ajax({
                    url: '/delete_topic/' + topicId,
                    type: 'GET',
                    success: function (response) {
                        element.remove();
                        // refresh total quota
                        var totalQuotaElement = $('#total-quota');
                        var currentTotalQuota = parseInt(totalQuotaElement.text());
                        totalQuotaElement.text(currentTotalQuota - quota);
                    },
                    error: function (xhr, status, error) {
                        console.error("Deletion failed: " + error);
                    }
                });
            }
        });

    </script>
    </body>
{% endblock %}